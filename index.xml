<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Bill Kidwell</title>
    <link>http://billkidwell.com/</link>
    <description>Recent content on Bill Kidwell</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <managingEditor>kidwell.bill&#43;site@gmail.com (Bill Kidwell)</managingEditor>
    <webMaster>kidwell.bill&#43;site@gmail.com (Bill Kidwell)</webMaster>
    <lastBuildDate>Mon, 04 Jul 2016 21:19:05 -0400</lastBuildDate>
    <atom:link href="http://billkidwell.com/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Some fun with d3 scales</title>
      <link>http://billkidwell.com/post/2016-07-04-some-fun-with-d3-scales/</link>
      <pubDate>Mon, 04 Jul 2016 21:19:05 -0400</pubDate>
      <author>kidwell.bill&#43;site@gmail.com (Bill Kidwell)</author>
      <guid>http://billkidwell.com/post/2016-07-04-some-fun-with-d3-scales/</guid>
      <description>

&lt;p&gt;In this article I expand on a tutorial that I enjoyed for d3. Most of the changes introduce the use of scales.  I start by introducing scales for calculating the locations and sizes of the marks on the chart, then apply them to vary the color of the marks and the associated labels.&lt;/p&gt;

&lt;p&gt;I have been working with d3 on and off for the past year. It is a great library, and there are tons of great resources for learning d3.&lt;/p&gt;

&lt;p&gt;One of the tutorials I like is &lt;a href=&#34;http://alignedleft.com/tutorials/d3/making-a-bar-chart&#34;&gt;Making a bar chart&lt;/a&gt; by Scott Murray.  If you are looking for d3 resources you may want to have a look, or go straight to his recent book, &lt;a href=&#34;http://chimera.labs.oreilly.com/books/1230000000345/&#34;&gt;Interactive Data Visualization&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In this post, I am going to go through some changes to the bar chart that I made for my own purposes.&lt;/p&gt;

&lt;p&gt;You can see a &amp;ldquo;final&amp;rdquo; result &lt;a href=&#34;http://codepen.io/bill-kidwell/pen/ZOKgPQ&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;p data-height=&#34;284&#34; data-theme-id=&#34;dark&#34; data-slug-hash=&#34;ZOKgPQ&#34; data-default-tab=&#34;result&#34; data-user=&#34;bill-kidwell&#34; data-embed-version=&#34;2&#34; class=&#34;codepen&#34;&gt;See the Pen &lt;a href=&#34;http://codepen.io/bill-kidwell/pen/ZOKgPQ/&#34;&gt;D3 Bar Chart with Labels&lt;/a&gt; by Bill Kidwell (&lt;a href=&#34;http://codepen.io/bill-kidwell&#34;&gt;@bill-kidwell&lt;/a&gt;) on &lt;a href=&#34;http://codepen.io&#34;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;
&lt;script async src=&#34;//assets.codepen.io/assets/embed/ei.js&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h2 id=&#34;throw-in-a-little-es2015&#34;&gt;Throw in a little es2015&lt;/h2&gt;

&lt;p&gt;I am a big fan of babel.js and the new JavaScript language features.  One of the first things I did to tidy things up is replace some of the functions with big arrow syntax.&lt;/p&gt;

&lt;p&gt;So this fragment of code&amp;hellip;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;y&amp;quot;, function(d) {
    return h - d;  //Height minus data value
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;becomes this fragment of code&amp;hellip;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;y&amp;quot;, (d) =&amp;gt; h - d ); // Height minus data value
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is a minor, stylistic change.  I only mention it because you will notice the differences.&lt;/p&gt;

&lt;h2 id=&#34;separate-svg-dimensions-from-chart-dimensions&#34;&gt;Separate SVG dimensions from chart dimensions&lt;/h2&gt;

&lt;p&gt;I used this example as a starting point for another project. It could be extended to include multiple series, a legend, a title and subtitle, or other chart elements.  Step 1 of making this possible is to separate the dimensions of the svg canvas and the dimensions of the chart area.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;// The canvas represents the entire SVG
var canvas = { w: 1000, h: 500 };
// Chart area is where the primary chart graphic appears
var chart = { w: 500, h: 100, x: 100, y: 100 };
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now, I create the svg using the canvas object.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var svg = d3.select(&amp;quot;body&amp;quot;)
                        .append(&amp;quot;svg&amp;quot;)
                        .attr(&amp;quot;width&amp;quot;, canvas.w)
                        .attr(&amp;quot;height&amp;quot;, canvas.h);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I also create a &lt;code&gt;g&lt;/code&gt; element to contain the chart area.  I translate its contents by the x and y coordinates.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var group = svg.append(&amp;quot;g&amp;quot;)
                .attr(&amp;quot;transform&amp;quot;, &amp;quot;translate(&amp;quot; + chart.x + &amp;quot;,&amp;quot; + chart.y + &amp;quot;)&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This also requires that we change the lines that begin &lt;code&gt;svg.selectAll(...&lt;/code&gt; with &lt;code&gt;group.selectAll(...&lt;/code&gt; so that our rect and text elements are contained within the grouping tag.&lt;/p&gt;

&lt;h2 id=&#34;introducing-scales&#34;&gt;Introducing scales&lt;/h2&gt;

&lt;p&gt;Scott covers scales later in the tutorial, but on another chart type. I thought it would be good practice to come back to this example and make it work with scales.&lt;/p&gt;

&lt;h3 id=&#34;x-scale&#34;&gt;x scale&lt;/h3&gt;

&lt;p&gt;The x scale for this data is ordinal, and we will use a 10% padding.  In d3, you can set that up with these two lines.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var x = d3.scale.ordinal()
       .rangeBands([0, chart.w], .1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In order to translate data values to coordinates on this scale, we must set the domain of the scale. Normally, we would map this to labels, but we are only using the single array.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;x.domain(dataset.map( (d) =&amp;gt; d ));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In the tutorial, the x location of the bars was calculated manually by taking the total width, dividing by the number of bars, and multiplying by the index of the data.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;x&amp;quot;, function(d, i) {
    return i * (w / dataset.length);
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Using the scale, things get much simpler for the rect elements.  Simply using the scale function gets us the proper value for the x location, and the &lt;code&gt;rangeBand&lt;/code&gt; function returns the appropriate width for the bar.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;x&amp;quot;, (d) =&amp;gt; x(d))
.attr(&amp;quot;width&amp;quot;, x.rangeBand())
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For the text, we need to add &lt;sup&gt;1&lt;/sup&gt;&amp;frasl;&lt;sub&gt;2&lt;/sub&gt; the width of the bar. You can get the bar width using the &lt;code&gt;rangeBand&lt;/code&gt; method of the ordinal scale.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;x&amp;quot;, (d) =&amp;gt; x(d) + 0.5 * x.rangeBand() ) // center of bar
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So far, the version with scales is actually much simpler!  Of course, you have to understand scales, and the point of the tutorial was to build up to that.&lt;/p&gt;

&lt;h3 id=&#34;y-scale&#34;&gt;y scale&lt;/h3&gt;

&lt;p&gt;The y scale is linear.  The range parameters look backwards, until you recall that y===0 is at the top of the svg (or group, in our case).  We set the domain of the scale a bit later using zero and the max value from the dataset.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var y = d3.scale.linear()
          .range([chart.h, 0]);
/* ... code omitted for brevity ... */
y.domain([0, d3.max(dataset)]);          
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Manually calculating the y location and height in the previous version required the use of a constant.  This limits the usefulness of the bar chart, since it will only work on values in the range of 0-25 (other bars would be too high and be cut off).&lt;/p&gt;

&lt;p&gt;Again, the y location can be determined using the scale function, and the height is calculated by subtracting that value from the height.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;y&amp;quot;, (d) =&amp;gt; y(d))
.attr(&amp;quot;height&amp;quot;, (d) =&amp;gt; chart.h - y(d) )
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Similarly, the y location of the text is the rect&amp;rsquo;s y location with a hardcoded offset.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;y&amp;quot;, (d) =&amp;gt; y(d) + 15 )
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;color-scales&#34;&gt;color scales&lt;/h3&gt;

&lt;p&gt;One of the things I really liked about the tutorial was the way that the author colored in the bars. Although he seemed to be foreshadowing future topics, I thought it added interest to an otherwise boring visualization. For reference, I have repeated the function below.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;fill&amp;quot;, function(d) {
    return &amp;quot;rgb(0, 0, &amp;quot; + (d * 10) + &amp;quot;)&amp;quot;;
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This particular function also suffers from the limitations above.  When I ran into the problem, I decided to use scales for the color of the bars as well.  To replicate the behavior, you can use a scale like this&amp;hellip;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var blueScale = d3.scale.linear()
                    .domain([d3.min(dataset), d3.max(dataset)])
                    .range([&amp;quot;black&amp;quot;, &amp;quot;blue&amp;quot;]);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Using this scale, we can specify the fill color as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.attr(&amp;quot;fill&amp;quot;, (d) =&amp;gt; blueScale(d))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is quite useful, but I wanted to take it a bit further.  I ended up using a color range that varies from a light blue for lower values to a dark blue for larger values. This introduces a new problem, as I need the fill color of the text to vary as well.  My first attempt used an inverted scale.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var blueScale = d3.scale.linear()
                    .domain([d3.min(dataset), d3.max(dataset)])
                    .range([&amp;quot;lightblue&amp;quot;, &amp;quot;darkblue&amp;quot;]);

var inverseBlue = d3.scale.linear()
                    .domain([d3.max(dataset), d3.min(dataset)])
                    .range([&amp;quot;lightblue&amp;quot;, &amp;quot;darkblue&amp;quot;]);

// For the bar
   .attr(&amp;quot;fill&amp;quot;, (d) =&amp;gt; blueScale(d))

// For the text
   .attr(&amp;quot;fill&amp;quot;, (d) =&amp;gt; inverseBlue(d))

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This works very well for a first try, but values in the middle of the range get similar shades of blue for the bar, and the text. d3 has some functions to change the value of colors to lighter or darker shades.  However, how do I know if I am working with a dark color, or light color in the first place? To solve this problem, I looked at the code for &lt;a href=&#34;https://github.com/bgrins/TinyColor&#34;&gt;TinyColor&lt;/a&gt;.  The following two functions are from tinycolor, with a slight modification to work with d3&amp;rsquo;s color values.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;function getBrightness(color) {
  //http://www.w3.org/TR/AERT#color-contrast
  var rgb = d3.rgb(color)
  return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
}

function isDark(color) {
  return getBrightness(color) &amp;lt; 128;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;getBrightness&lt;/code&gt; function returns a value for the brightness.  TinyColor&amp;rsquo;s &lt;code&gt;isDark&lt;/code&gt; function uses a value less than 128 as a dark value. With these two missing pieces, I put together a simple function that gives me a contrasting color.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;function contrastingColor(d) {
  var barColor = d3.rgb(blueScale(d));
  var color = d3.rgb(inverseBlue(d)); // start with the color from the inverse scale
  if (isDark(barColor)) return color.brighter(2);
  else return color.darker(2);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;First, I get the color of the bar.  I also get the color from the inverse scale as a starting point. If the barColor is dark, return a value that is 2 shades lighter than the inverse.  If it is not dark, return a color that is two shades darker than the inverse.&lt;/p&gt;

&lt;p&gt;I was pretty happy with the result.  I am sure there are more robust ways to achieve this effect.  If you know of any, please send me a comment.&lt;/p&gt;

&lt;p&gt;Hopefully you found this to be interesting.  If you have any suggestions or comments, please send them my way.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>why blog?</title>
      <link>http://billkidwell.com/post/2016-06-23-why-blog/</link>
      <pubDate>Thu, 23 Jun 2016 21:21:13 -0400</pubDate>
      <author>kidwell.bill&#43;site@gmail.com (Bill Kidwell)</author>
      <guid>http://billkidwell.com/post/2016-06-23-why-blog/</guid>
      <description>

&lt;p&gt;Perhaps blogs still have a purpose today, and perhaps they do not. Only time will tell. My purpose in setting this site is to begin writing again, and to share some things I learn with others.&lt;/p&gt;

&lt;h2 id=&#34;how-did-it-come-to-this&#34;&gt;How did it come to this?&lt;/h2&gt;

&lt;p&gt;My career has been a long, busy road. As soon as I started my professional life I also started taking graduate courses. I had promised myself when I was working on my B.S. that if I still enjoyed school when I finished, I would look at graduate school.&lt;/p&gt;

&lt;p&gt;I considered going straight to grad school, but the payoff was just not there.  A Master&amp;rsquo;s degree didn&amp;rsquo;t earn you much more without experience.  So, I decided my best course was to work on it part time.  I started working on my Master&amp;rsquo;s degree, but later switched to work on my Ph.D.&lt;/p&gt;

&lt;p&gt;I had a number of setbacks and breaks along the way.  We moved, I changed jobs, there were family situations, etc&amp;hellip; Getting your Ph.D. is difficult.  Getting it while working full time is &lt;em&gt;very&lt;/em&gt; difficult. But persistence pays off, and here I am.&lt;/p&gt;

&lt;p&gt;Once you finish a journey like that, it is a huge relief, and generally a good time to take a break. When I was in school, I was generally busy with coursework, conducting research, or otherwise occupied. I tried to start up blogs several times in that period, but it was difficult to keep a rhythm. After all, you are trying to contribute something to the research community.  That is pretty significant, and when that is your goal, it overshadows options like blogging &amp;ndash; or at least it did for me.&lt;/p&gt;

&lt;h2 id=&#34;now-what&#34;&gt;Now what?&lt;/h2&gt;

&lt;p&gt;Now the break has ended. I am in a good rhythm with work, the family, and ready to start writing and sharing. Hopefully it proves useful to someone out there.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>About me</title>
      <link>http://billkidwell.com/page/about/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <author>kidwell.bill&#43;site@gmail.com (Bill Kidwell)</author>
      <guid>http://billkidwell.com/page/about/</guid>
      <description>&lt;p&gt;My name is Bill Kidwell.  I am a software architect with HP Exstream in Lexington, KY. I have been working in the software industry since 1998. I completed my Ph.D. in Computer Science at the University of Kentucky in 2015.&lt;/p&gt;

&lt;p&gt;On a more personal note, I have been married to my wife, Nora, since 1998.  We are from the southern WV area.  We have spent most of our time here in Lexington. Our son, Alexander was born in 2013.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;../../img/Xander.jpg&#34; alt=&#34;Xander&#34; /&gt;
Photo credit: &lt;a href=&#34;http://www.julierobertsphoto.com/&#34;&gt;Julie Roberts Photography&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>